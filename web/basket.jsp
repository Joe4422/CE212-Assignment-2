<%@ page import="java.util.Collection,                 java.util.Iterator" %><%@ page import="shop.Product" %><%@ page import="java.util.Map" %><jsp:useBean id='basket'             scope='session'             class='shop.Basket'/><%    // Handles Empty Basket    String empty = request.getParameter("emptyBasket");    if (empty != null) {        basket.clearBasket();        response.sendRedirect("basket.jsp");    }    // Handles adding item    String item = request.getParameter("addItem");    if (item != null) {        basket.addItem(item);        response.sendRedirect("basket.jsp");    }    // Handles incrementing/decrementing item count    String quantityItem = request.getParameter("changeItem");    String offset = request.getParameter("changeQuantity");    if (quantityItem != null && offset != null) {        basket.modifyQuantity(quantityItem, Integer.parseInt(offset));        response.sendRedirect("basket.jsp");    }    // Handles removing an item from the basket    String removeItem = request.getParameter("removeItem");    if (removeItem != null) {        basket.removeItem(removeItem);        response.sendRedirect("basket.jsp");    }%><html>    <head>        <title>Basket</title>        <link rel="stylesheet" type="text/css" href="basket.css">    </head>    <body>        <style>            .topbar-button.topbar-basket {                background-color: rgba(255, 255, 255, 0.27);            }        </style>        <jsp:include page="topbar.jsp"/>        <% if (basket.getItems().size() > 0) { %>            <table>                <tr>                    <th>Picture</th>                    <th>Title</th>                    <th>Price</th>                    <th>Quantity</th>                    <th>Total</th>                    <th></th>                    <th></th>                    <th></th>                </tr>                <% Map<Product, Integer> items = basket.getItems();                    for (Product prod : items.keySet()) {                %>                <tr>                    <td><img class="product-image" src="<%= prod.thumbnail %>"/></td>                    <td>                        <a href="viewProduct.jsp?pid=<%= prod.PID %>"><%= prod.title %>                        </a>                    </td>                    <td>                        <%= prod.getFormattedPrice() %>                    </td>                    <td>                        <%= items.get(prod) %>                    </td>                    <td>                        <%= Product.getFormattedPrice(prod.price * items.get(prod)) %>                    </td>                    <td>                        <form class="table-button" action="basket.jsp" method="get">                            <input type="hidden" name="changeQuantity" value="-1">                            <input type="hidden" name="changeItem" value="<%= prod.PID %>">                            <input class="table-button" type="submit" value="-">                        </form>                    </td>                    <td>                        <form class="table-button" action="basket.jsp" method="get">                            <input type="hidden" name="changeQuantity" value="1">                            <input type="hidden" name="changeItem" value="<%= prod.PID %>">                            <input class="table-button" type="submit" value="+">                        </form>                    </td>                    <td>                        <form class="table-button" action="basket.jsp" method="get">                            <input type="hidden" name="removeItem" value="<%= prod.PID %>">                            <input type="submit" value="Remove">                        </form>                    </td>                </tr>                <% } %>            </table>        <% } else { %>            <p>Your basket is currently empty.</p>        <% } %>        <p> Order total = <%= basket.getTotalString() %>        <% if ( basket.getTotal() > 0) { %>            <script>                function submitBasket() {                    var regEx = /.+/;                    var name = document.getElementById("name").value;                    if (!regEx.test(name)) {                        alert("Please enter your name before ordering.");                        return false;                    } else {                        return true;                    }                }            </script>            <form onsubmit="return submitBasket();" action="order.jsp" method="post">                <input id="name" type="text" name="name" size="20">                <input type="submit" value="Place Order"/>            </form>            <form action="basket.jsp" method="get">                <input type="hidden" name="emptyBasket" value="yes">                <input type="submit" value="Empty Basket"/>            </form>        <% } %>    </body></html>